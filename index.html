<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackIt - Q&A Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom styles */
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #64748b;
            --accent-color: #f59e0b;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: var(--dark-color);
        }

        .editor {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            min-height: 200px;
            padding: 1rem;
            background-color: white;
        }

        .editor:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            background-color: #e0f2fe;
            color: #0369a1;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .vote-btn {
            color: var(--secondary-color);
            transition: all 0.2s;
        }

        .vote-btn:hover {
            color: var(--primary-color);
        }

        .upvoted {
            color: var(--primary-color);
        }

        .downvoted {
            color: #ef4444;
        }

        .accepted-answer {
            border-left: 4px solid var(--accent-color);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: bold;
        }

        /* Rich text editor toolbar */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            background-color: #f8fafc;
        }

        .toolbar button {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            border: none;
            background-color: transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toolbar button:hover {
            background-color: #e2e8f0;
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            min-width: 250px;
            z-index: 10;
            overflow: hidden;
        }

        /* Animation for notifications */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification-item {
            animation: fadeIn 0.3s ease-out;
            transition: all 0.2s;
        }

        .notification-item:hover {
            background-color: #f8fafc;
        }
    </style>
</head>
<body>
    <div class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-xl font-bold text-blue-600">StackIt</h1>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                            <a href="#" class="border-blue-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium" id="home-link">
                                Home
                            </a>
                            <a href="#" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium" id="tags-link">
                                Tags
                            </a>
                            <a href="#" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium" id="users-link">
                                Users
                            </a>
                        </div>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:items-center">
                        <div class="relative ml-3 mr-4" id="notification-container">
                            <button type="button" class="bg-white rounded-full flex text-sm focus:outline-none relative" id="notification-btn">
                                <i class="fas fa-bell text-gray-500 hover:text-gray-700"></i>
                                <span class="notification-badge hidden" id="notification-count">3</span>
                            </button>
                            <!-- Notification dropdown -->
                            <div class="dropdown-menu hidden" id="notification-dropdown">
                                <div class="py-1">
                                    <div class="px-4 py-2 border-b border-gray-100">
                                        <p class="text-sm font-medium text-gray-900">Notifications</p>
                                    </div>
                                    <div class="max-h-80 overflow-y-auto">
                                        <!-- Notification items will be added here by JavaScript -->
                                    </div>
                                    <div class="px-4 py-2 border-t border-gray-100 text-center">
                                        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">View all notifications</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="relative" id="user-menu-container">
                            <button type="button" class="bg-white rounded-full flex text-sm focus:outline-none" id="user-menu-btn">
                                <span class="sr-only">Open user menu</span>
                                <img class="h-8 w-8 rounded-full" src="https://placehold.co/100x100" alt="User profile picture">
                            </button>
                            <!-- User menu dropdown -->
                            <div class="dropdown-menu hidden" id="user-menu-dropdown">
                                <div class="py-1">
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Your Profile</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="logout-btn">Sign out</a>
                                </div>
                            </div>
                        </div>
                        <button class="ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none" id="ask-question-btn">
                            Ask Question
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Content Area -->
                <div class="lg:w-3/4">
                    <div class="mb-6" id="questions-container">
                        <!-- Question cards will be added here -->
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="lg:w-1/4">
                    <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                        <h2 class="text-lg font-medium text-gray-900 mb-4">Top Tags</h2>
                        <div class="flex flex-wrap" id="tags-container">
                            <!-- Tags will be added here -->
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <h2 class="text-lg font-medium text-gray-900 mb-4">About StackIt</h2>
                        <p class="text-sm text-gray-600">StackIt is a minimal Q&A platform designed for collaborative learning and knowledge sharing. Ask questions, get answers, and help others by answering their questions.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ask Question Modal -->
        <div class="fixed z-10 inset-0 overflow-y-auto hidden" id="ask-question-modal">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Ask a Question</h3>
                                <div class="w-full">
                                    <div class="mb-4">
                                        <label for="question-title" class="block text-sm font-medium text-gray-700">Title</label>
                                        <input type="text" id="question-title" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                    </div>
                                    <div class="mb-4">
                                        <label for="question-description" class="block text-sm font-medium text-gray-700">Description</label>
                                        <div class="toolbar mb-2">
                                            <button type="button" data-command="bold"><i class="fas fa-bold"></i></button>
                                            <button type="button" data-command="italic"><i class="fas fa-italic"></i></button>
                                            <button type="button" data-command="strikethrough"><i class="fas fa-strikethrough"></i></button>
                                            <button type="button" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>
                                            <button type="button" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                                            <button type="button" data-command="createLink"><i class="fas fa-link"></i></button>
                                            <button type="button" data-command="insertImage"><i class="fas fa-image"></i></button>
                                            <button type="button" data-command="justifyLeft"><i class="fas fa-align-left"></i></button>
                                            <button type="button" data-command="justifyCenter"><i class="fas fa-align-center"></i></button>
                                            <button type="button" data-command="justifyRight"><i class="fas fa-align-right"></i></button>
                                        </div>
                                        <div id="question-description" class="editor" contenteditable="true"></div>
                                    </div>
                                    <div class="mb-4">
                                        <label for="question-tags" class="block text-sm font-medium text-gray-700">Tags</label>
                                        <input type="text" id="question-tags" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border" placeholder="Add tags separated by commas (e.g., react, javascript, css)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm" id="submit-question-btn">
                            Post Question
                        </button>
                        <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm" id="cancel-question-btn">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Question Detail Modal -->
        <div class="fixed z-10 inset-0 overflow-y-auto hidden" id="question-detail-modal">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="text-xl font-medium text-gray-900" id="detail-question-title"></h3>
                                    <button id="close-detail-btn" class="text-gray-400 hover:text-gray-500">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="flex items-center text-sm text-gray-500 mb-4">
                                    <span id="detail-question-author"></span>
                                    <span class="mx-1">•</span>
                                    <span id="detail-question-date"></span>
                                </div>
                                <div class="mb-6 p-4 bg-gray-50 rounded-lg" id="detail-question-body"></div>
                                <div class="flex flex-wrap mb-6" id="detail-question-tags"></div>
                                
                                <div class="mb-6">
                                    <h4 class="text-lg font-medium text-gray-900 mb-4">Answers</h4>
                                    <div id="answers-container">
                                        <!-- Answers will be added here -->
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h4 class="text-lg font-medium text-gray-900 mb-2">Your Answer</h4>
                                    <div class="toolbar mb-2">
                                        <button type="button" data-command="bold"><i class="fas fa-bold"></i></button>
                                        <button type="button" data-command="italic"><i class="fas fa-italic"></i></button>
                                        <button type="button" data-command="strikethrough"><i class="fas fa-strikethrough"></i></button>
                                        <button type="button" data-command="insertOrderedList"><i class="fas fa-list-ol"></i></button>
                                        <button type="button" data-command="insertUnorderedList"><i class="fas fa-list-ul"></i></button>
                                        <button type="button" data-command="createLink"><i class="fas fa-link"></i></button>
                                        <button type="button" data-command="insertImage"><i class="fas fa-image"></i></button>
                                        <button type="button" data-command="justifyLeft"><i class="fas fa-align-left"></i></button>
                                        <button type="button" data-command="justifyCenter"><i class="fas fa-align-center"></i></button>
                                        <button type="button" data-command="justifyRight"><i class="fas fa-align-right"></i></button>
                                    </div>
                                    <div id="answer-input" class="editor mb-4" contenteditable="true"></div>
                                    <button id="post-answer-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Post Answer</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="fixed z-10 inset-0 overflow-y-auto hidden" id="login-modal">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Login to StackIt</h3>
                                <div class="mb-4">
                                    <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" id="login-email" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                                <div class="mb-4">
                                    <label for="login-password" class="block text-sm font-medium text-gray-700">Password</label>
                                    <input type="password" id="login-password" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center">
                                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="remember-me" class="ml-2 block text-sm text-gray-900">Remember me</label>
                                    </div>
                                    <div class="text-sm">
                                        <a href="#" class="font-medium text-blue-600 hover:text-blue-500">Forgot password?</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm" id="login-submit-btn">
                            Login
                        </button>
                        <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm" id="login-cancel-btn">
                            Cancel
                        </button>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 text-center border-t border-gray-200">
                        <p class="text-sm text-gray-600">
                            Don't have an account? 
                            <button id="show-register-btn" class="font-medium text-blue-600 hover:text-blue-500">Register</button>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Register Modal -->
        <div class="fixed z-10 inset-0 overflow-y-auto hidden" id="register-modal">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Register for StackIt</h3>
                                <div class="mb-4">
                                    <label for="register-name" class="block text-sm font-medium text-gray-700">Name</label>
                                    <input type="text" id="register-name" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                                <div class="mb-4">
                                    <label for="register-email" class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" id="register-email" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                                <div class="mb-4">
                                    <label for="register-password" class="block text-sm font-medium text-gray-700">Password</label>
                                    <input type="password" id="register-password" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                                <div class="mb-4">
                                    <label for="register-confirm-password" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                                    <input type="password" id="register-confirm-password" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2 border">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm" id="register-submit-btn">
                            Register
                        </button>
                        <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm" id="register-cancel-btn">
                            Cancel
                        </button>
                    </div>
                    <div class="px-4 py-3 bg-gray-50 text-center border-t border-gray-200">
                        <p class="text-sm text-gray-600">
                            Already have an account? 
                            <button id="show-login-btn" class="font-medium text-blue-600 hover:text-blue-500">Login</button>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App state
        const state = {
            currentUser: null,
            questions: [],
            tags: [],
            notifications: [],
            currentQuestion: null,
            answers: [],
            isLoggedIn: false
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadSampleData();
            renderQuestions();
            renderTags();
            renderNotifications();
            
            // Check if user is logged in (for demo purposes)
            checkLoginStatus();
        });

        function checkLoginStatus() {
            // In a real app, this would check cookies/local storage
            const loggedIn = Math.random() > 0.5; // 50% chance for demo
            if (loggedIn) {
                state.currentUser = {
                    id: 1,
                    name: 'John Doe',
                    email: 'john@example.com',
                    avatar: 'https://placehold.co/100x100'
                };
                state.isLoggedIn = true;
                updateAuthUI();
            }
        }

        function setupEventListeners() {
            // Ask question button
            document.getElementById('ask-question-btn').addEventListener('click', function() {
                if (!state.isLoggedIn) {
                    showLoginModal();
                    return;
                }
                document.getElementById('ask-question-modal').classList.remove('hidden');
                document.getElementById('question-title').value = '';
                document.getElementById('question-description').innerHTML = '';
                document.getElementById('question-tags').value = '';
            });

            // Cancel question button
            document.getElementById('cancel-question-btn').addEventListener('click', function() {
                document.getElementById('ask-question-modal').classList.add('hidden');
            });

            // Submit question button
            document.getElementById('submit-question-btn').addEventListener('click', function() {
                const title = document.getElementById('question-title').value.trim();
                const description = document.getElementById('question-description').innerHTML;
                const tagsInput = document.getElementById('question-tags').value.trim();
                
                if (!title) {
                    alert('Please enter a title for your question');
                    return;
                }
                
                if (!description || description === '<br>') {
                    alert('Please enter a description for your question');
                    return;
                }
                
                const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
                if (tags.length === 0) {
                    alert('Please add at least one tag');
                    return;
                }
                
                // Add new question
                const newQuestion = {
                    id: state.questions.length + 1,
                    title,
                    description,
                    tags,
                    author: state.currentUser.name,
                    authorId: state.currentUser.id,
                    date: new Date().toISOString(),
                    votes: 0,
                    answerCount: 0,
                    views: 0
                };
                
                state.questions.unshift(newQuestion);
                renderQuestions();
                document.getElementById('ask-question-modal').classList.add('hidden');
                
                // Add tags if they don't exist
                tags.forEach(tag => {
                    if (!state.tags.some(t => t.name === tag.toLowerCase())) {
                        state.tags.push({
                            id: state.tags.length + 1,
                            name: tag.toLowerCase(),
                            questionCount: 1
                        });
                    } else {
                        const existingTag = state.tags.find(t => t.name === tag.toLowerCase());
                        existingTag.questionCount++;
                    }
                });
                
                renderTags();
            });

            // Notification button
            document.getElementById('notification-btn').addEventListener('click', function() {
                const dropdown = document.getElementById('notification-dropdown');
                dropdown.classList.toggle('hidden');
                
                // Mark notifications as read when dropdown is opened
                if (!dropdown.classList.contains('hidden')) {
                    state.notifications.forEach(notification => {
                        notification.read = true;
                    });
                    document.getElementById('notification-count').classList.add('hidden');
                }
            });

            // User menu button
            document.getElementById('user-menu-btn').addEventListener('click', function() {
                document.getElementById('user-menu-dropdown').classList.toggle('hidden');
            });

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                state.currentUser = null;
                state.isLoggedIn = false;
                updateAuthUI();
                document.getElementById('user-menu-dropdown').classList.add('hidden');
            });

            // Login button
            document.getElementById('login-submit-btn').addEventListener('click', function() {
                const email = document.getElementById('login-email').value.trim();
                const password = document.getElementById('login-password').value.trim();
                
                if (!email || !password) {
                    alert('Please enter both email and password');
                    return;
                }
                
                // In a real app, this would authenticate with the server
                state.currentUser = {
                    id: 1,
                    name: 'John Doe',
                    email: email,
                    avatar: 'https://placehold.co/100x100'
                };
                state.isLoggedIn = true;
                updateAuthUI();
                document.getElementById('login-modal').classList.add('hidden');
            });

            // Register button
            document.getElementById('register-submit-btn').addEventListener('click', function() {
                const name = document.getElementById('register-name').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value.trim();
                const confirmPassword = document.getElementById('register-confirm-password').value.trim();
                
                if (!name || !email || !password || !confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                // In a real app, this would register with the server
                state.currentUser = {
                    id: 1,
                    name: name,
                    email: email,
                    avatar: 'https://placehold.co/100x100'
                };
                state.isLoggedIn = true;
                updateAuthUI();
                document.getElementById('register-modal').classList.add('hidden');
            });

            // Show register form
            document.getElementById('show-register-btn').addEventListener('click', function() {
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('register-modal').classList.remove('hidden');
            });

            // Show login form
            document.getElementById('show-login-btn').addEventListener('click', function() {
                document.getElementById('register-modal').classList.add('hidden');
                document.getElementById('login-modal').classList.remove('hidden');
            });

            // Login cancel buttons
            document.getElementById('login-cancel-btn').addEventListener('click', function() {
                document.getElementById('login-modal').classList.add('hidden');
            });
            document.getElementById('register-cancel-btn').addEventListener('click', function() {
                document.getElementById('register-modal').classList.add('hidden');
            });

            // Rich text editor toolbar
            document.querySelectorAll('.toolbar button').forEach(button => {
                button.addEventListener('click', function() {
                    const command = this.getAttribute('data-command');
                    
                    if (!command) return;
                    
                    if (command === 'createLink' || command === 'insertImage') {
                        const url = prompt(command === 'createLink' ? 'Enter the URL:' : 'Enter the image URL:', 'http://');
                        if (url) {
                            document.execCommand(command, false, url);
                        }
                    } else {
                        document.execCommand(command, false);
                    }
                    
                    // Find the nearest editor and focus it
                    const editor = this.closest('.toolbar').nextElementSibling;
                    if (editor) {
                        editor.focus();
                    }
                });
            });

            // Close question detail modal
            document.getElementById('close-detail-btn').addEventListener('click', function() {
                document.getElementById('question-detail-modal').classList.add('hidden');
            });

            // Post answer button
            document.getElementById('post-answer-btn').addEventListener('click', function() {
                if (!state.isLoggedIn) {
                    showLoginModal();
                    return;
                }
                
                const answerContent = document.getElementById('answer-input').innerHTML;
                
                if (!answerContent || answerContent === '<br>') {
                    alert('Please enter an answer');
                    return;
                }
                
                const newAnswer = {
                    id: state.answers.length + 1,
                    questionId: state.currentQuestion.id,
                    content: answerContent,
                    author: state.currentUser.name,
                    authorId: state.currentUser.id,
                    date: new Date().toISOString(),
                    votes: 0,
                    accepted: false
                };
                
                state.answers.push(newAnswer);
                renderAnswers();
                document.getElementById('answer-input').innerHTML = '';
                
                // Increment answer count in question
                const question = state.questions.find(q => q.id === state.currentQuestion.id);
                if (question) {
                    question.answerCount++;
                }
                
                // Add notification to question owner
                if (state.currentQuestion.authorId !== state.currentUser.id) {
                    state.notifications.unshift({
                        id: state.notifications.length + 1,
                        type: 'answer',
                        message: `${state.currentUser.name} answered your question: "${state.currentQuestion.title}"`,
                        read: false,
                        date: new Date().toISOString()
                    });
                    
                    document.getElementById('notification-count').textContent = state.notifications.filter(n => !n.read).length;
                    document.getElementById('notification-count').classList.remove('hidden');
                    
                    renderNotifications();
                }
            });
        }

        function updateAuthUI() {
            if (state.isLoggedIn) {
                document.getElementById('user-menu-btn').querySelector('img').src = state.currentUser.avatar;
                document.getElementById('user-menu-btn').querySelector('img').alt = `${state.currentUser.name}'s profile picture`;
            }
        }

        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function loadSampleData() {
            // Sample tags
            state.tags = [
                { id: 1, name: 'javascript', questionCount: 12 },
                { id: 2, name: 'react', questionCount: 8 },
                { id: 3, name: 'css', questionCount: 15 },
                { id: 4, name: 'html', questionCount: 10 },
                { id: 5, name: 'node', questionCount: 7 }
            ];

            // Sample questions
            state.questions = [
                {
                    id: 1,
                    title: 'How to center a div in CSS?',
                    description: 'I\'ve been trying to center a div both horizontally and vertically, but none of the methods I\'ve tried seem to work. What\'s the best way to do this in modern CSS?',
                    tags: ['css', 'html'],
                    author: 'Jane Smith',
                    authorId: 2,
                    date: '2023-05-15T10:30:00Z',
                    votes: 8,
                    answerCount: 3,
                    views: 45
                },
                {
                    id: 2,
                    title: 'React hooks vs class components - which to use?',
                    description: 'I\'m new to React and trying to understand when I should use hooks and when I should stick with class components. Are there any performance differences?',
                    tags: ['react', 'javascript'],
                    author: 'Mike Johnson',
                    authorId: 3,
                    date: '2023-05-10T14:15:00Z',
                    votes: 15,
                    answerCount: 7,
                    views: 89
                },
                {
                    id: 3,
                    title: 'Best practices for Node.js error handling',
                    description: 'I\'m building a Node.js API and want to implement proper error handling. What are some best practices for handling errors in async/await patterns?',
                    tags: ['node', 'javascript'],
                    author: 'Sarah Williams',
                    authorId: 4,
                    date: '2023-05-05T09:45:00Z',
                    votes: 12,
                    answerCount: 5,
                    views: 67
                }
            ];

            // Sample answers
            state.answers = [
                {
                    id: 1,
                    questionId: 1,
                    content: 'You can use flexbox to center a div both horizontally and vertically. Here\'s how:<br><br><pre>.container {<br>  display: flex;<br>  justify-content: center;<br>  align-items: center;<br>}</pre>',
                    author: 'David Brown',
                    authorId: 5,
                    date: '2023-05-15T11:30:00Z',
                    votes: 5,
                    accepted: true
                },
                {
                    id: 2,
                    questionId: 1,
                    content: 'Another approach is to use CSS Grid:<br><br><pre>.container {<br>  display: grid;<br>  place-items: center;<br>}</pre>',
                    author: 'Emma Davis',
                    authorId: 6,
                    date: '2023-05-15T12:45:00Z',
                    votes: 3,
                    accepted: false
                },
                {
                    id: 3,
                    questionId: 2,
                    content: 'For most new projects, I would recommend using hooks. They make the code cleaner and easier to understand. The React team is also focusing more on hooks for future development.',
                    author: 'Robert Wilson',
                    authorId: 7,
                    date: '2023-05-10T15:20:00Z',
                    votes: 7,
                    accepted: true
                }
            ];

            // Sample notifications
            state.notifications = [
                {
                    id: 1,
                    type: 'answer',
                    message: 'David Brown answered your question: "How to center a div in CSS?"',
                    read: false,
                    date: '2023-05-15T11:30:00Z'
                },
                {
                    id: 2,
                    type: 'vote',
                    message: 'Your answer got 3 upvotes on "React hooks vs class components"',
                    read: false,
                    date: '2023-05-11T09:15:00Z'
                },
                {
                    id: 3,
                    type: 'mention',
                    message: '@john_doe mentioned you in a comment on "Best practices for Node.js error handling"',
                    read: false,
                    date: '2023-05-08T14:30:00Z'
                }
            ];

            document.getElementById('notification-count').textContent = state.notifications.filter(n => !n.read).length;
            document.getElementById('notification-count').classList.remove('hidden');
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            if (state.questions.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No questions yet. Be the first to ask!</p>';
                return;
            }
            
            state.questions.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'bg-white rounded-lg shadow-sm p-4 mb-4 cursor-pointer hover:shadow-md transition-shadow';
                questionCard.addEventListener('click', () => showQuestionDetail(question));
                
                const votes = document.createElement('div');
                votes.className = 'flex flex-col items-center mr-4';
                votes.innerHTML = `
                    <button class="vote-btn ${question.votes > 0 ? 'upvoted' : ''}" data-question-id="${question.id}" data-type="upvote">
                        <i class="fas fa-caret-up text-2xl"></i>
                    </button>
                    <span class="font-medium text-gray-700 my-1">${question.votes}</span>
                    <button class="vote-btn ${question.votes < 0 ? 'downvoted' : ''}" data-question-id="${question.id}" data-type="downvote">
                        <i class="fas fa-caret-down text-2xl"></i>
                    </button>
                `;
                
                const content = document.createElement('div');
                content.className = 'flex-1 overflow-hidden';
                content.innerHTML = `
                    <h3 class="text-lg font-medium text-gray-900 mb-2 overflow-hidden text-ellipsis whitespace-nowrap">${question.title}</h3>
                    <p class="text-gray-600 text-sm mb-2 line-clamp-2">${stripHtml(question.description)}</p>
                    <div class="flex flex-wrap">
                        ${question.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <div class="flex justify-between items-center mt-4 text-sm text-gray-500">
                        <span>${question.answerCount} answers • ${question.views} views</span>
                        <div class="flex items-center">
                            <img src="https://placehold.co/40x40" alt="User avatar" class="h-6 w-6 rounded-full mr-2">
                            <span>${question.author}</span>
                            <span class="mx-2">•</span>
                            <span>${formatDate(question.date)}</span>
                        </div>
                    </div>
                `;
                
                questionCard.appendChild(votes);
                questionCard.appendChild(content);
                container.appendChild(questionCard);
            });

            // Add vote handlers
            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (!state.isLoggedIn) {
                        showLoginModal();
                        return;
                    }
                    
                    const questionId = parseInt(this.getAttribute('data-question-id'));
                    const voteType = this.getAttribute('data-type');
                    const question = state.questions.find(q => q.id === questionId);
                    
                    if (!question) return;
                    
                    if (voteType === 'upvote') {
                        question.votes++;
                    } else {
                        question.votes--;
                    }
                    
                    renderQuestions();
                });
            });
        }

        function renderTags() {
            const container = document.getElementById('tags-container');
            container.innerHTML = '';
            
            state.tags.forEach(tag => {
                const tagElement = document.createElement('a');
                tagElement.href = '#';
                tagElement.className = 'mr-2 mb-2 inline-block';
                tagElement.innerHTML = `
                    <span class="tag">${tag.name}</span>
                    <span class="text-xs text-gray-500">${tag.questionCount}</span>
                `;
                container.appendChild(tagElement);
            });
        }

        function renderNotifications() {
            const container = document.getElementById('notification-dropdown').querySelector('.max-h-80');
            container.innerHTML = '';
            
            if (state.notifications.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm p-4">No notifications</p>';
                return;
            }
            
            state.notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item px-4 py-3 ${notification.read ? '' : 'bg-blue-50'}`;
                
                // Create icon based on notification type
                let iconClass = 'fa-bell';
                if (notification.type === 'answer') iconClass = 'fa-comment-alt';
                if (notification.type === 'vote') iconClass = 'fa-thumbs-up';
                if (notification.type === 'mention') iconClass = 'fa-at';
                
                notificationItem.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas ${iconClass} text-blue-500 mt-1 mr-3"></i>
                        </div>
                        <div class="text-sm">
                            <p class="text-gray-700">${notification.message}</p>
                            <p class="text-xs text-gray-500 mt-1">${formatDate(notification.date)}</p>
                        </div>
                    </div>
                `;
                container.appendChild(notificationItem);
            });
        }

        function showQuestionDetail(question) {
            document.getElementById('question-detail-modal').classList.remove('hidden');
            document.getElementById('detail-question-title').textContent = question.title;
            document.getElementById('detail-question-body').innerHTML = question.description;
            document.getElementById('detail-question-author').textContent = `Asked by ${question.author}`;
            document.getElementById('detail-question-date').textContent = formatDate(question.date);
            
            const tagsContainer = document.getElementById('detail-question-tags');
            tagsContainer.innerHTML = '';
            question.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagsContainer.appendChild(tagElement);
            });
            
            state.currentQuestion = question;
            
            // Increment view count
            question.views++;
            
            renderAnswers();
        }

        function renderAnswers() {
            const container = document.getElementById('answers-container');
            container.innerHTML = '';
            
            const questionAnswers = state.answers.filter(answer => answer.questionId === state.currentQuestion.id);
            
            if (questionAnswers.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No answers yet. Be the first to answer!</p>';
                return;
            }
            
            questionAnswers.sort((a, b) => {
                // Accepted answers first
                if (a.accepted && !b.accepted) return -1;
                if (!a.accepted && b.accepted) return 1;
                
                // Then by votes
                if (a.votes !== b.votes) return b.votes - a.votes;
                
                // Then by date
                return new Date(b.date) - new Date(a.date);
            }).forEach(answer => {
                const answerElement = document.createElement('div');
                answerElement.className = `bg-white rounded-lg shadow-sm p-4 mb-4 ${answer.accepted ? 'accepted-answer' : ''}`;
                
                answerElement.innerHTML = `
                    <div class="flex">
                        <div class="flex flex-col items-center mr-4">
                            <button class="vote-btn ${answer.votes > 0 ? 'upvoted' : ''}" data-answer-id="${answer.id}" data-type="upvote">
                                <i class="fas fa-caret-up text-2xl"></i>
                            </button>
                            <span class="font-medium text-gray-700 my-1">${answer.votes}</span>
                            <button class="vote-btn ${answer.votes < 0 ? 'downvoted' : ''}" data-answer-id="${answer.id}" data-type="downvote">
                                <i class="fas fa-caret-down text-2xl"></i>
                            </button>
                            ${state.isLoggedIn && state.currentQuestion.authorId === state.currentUser.id && !answer.accepted ? 
                                `<button class="mt-2 text-sm text-gray-500 hover:text-yellow-600" data-answer-id="${answer.id}" data-action="accept">
                                    <i class="fas fa-check"></i> Accept
                                </button>` : ''}
                            ${answer.accepted ? 
                                `<div class="mt-2 text-sm text-yellow-600">
                                    <i class="fas fa-check-circle"></i> Accepted
                                </div>` : ''}
                        </div>
                        <div class="flex-1">
                            <div class="mb-2">${answer.content}</div>
                            <div class="flex justify-between items-center text-sm text-gray-500">
                                <div class="flex items-center">
                                    <img src="https://placehold.co/40x40" alt="User avatar" class="h-6 w-6 rounded-full mr-2">
                                    <span>${answer.author}</span>
                                </div>
                                <span>${formatDate(answer.date)}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(answerElement);
            });
            
            // Add vote handlers
            document.querySelectorAll('[data-answer-id]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (!state.isLoggedIn) {
                        showLoginModal();
                        return;
                    }
                    
                    const answerId = parseInt(this.getAttribute('data-answer-id'));
                    const action = this.getAttribute('data-action');
                    const answer = state.answers.find(a => a.id === answerId);
                    
                    if (!answer) return;
                    
                    if (action === 'accept') {
                        // Unaccept any previously accepted answer for this question
                        state.answers.forEach(a => {
                            if (a.questionId === state.currentQuestion.id) {
                                a.accepted = false;
                            }
                        });
                        
                        answer.accepted = true;
                    } else {
                        const voteType = this.getAttribute('data-type');
                        
                        if (voteType === 'upvote') {
                            answer.votes++;
                        } else {
                            answer.votes--;
                        }
                    }
                    
                    renderAnswers();
                });
            });
        }

        // Helper functions
        function stripHtml(html) {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || '';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return `${diffInSeconds} seconds ago`;
            }
            
            const diffInMinutes = Math.floor(diffInSeconds / 60);
            if (diffInMinutes < 60) {
                return `${diffInMinutes} minute${diffInMinutes === 1 ? '' : 's'} ago`;
            }
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) {
                return `${diffInHours} hour${diffInHours === 1 ? '' : 's'} ago`;
            }
            
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays} day${diffInDays === 1 ? '' : 's'} ago`;
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('#notification-container') && !event.target.closest('#notification-dropdown')) {
                document.getElementById('notification-dropdown').classList.add('hidden');
            }
            
            if (!event.target.closest('#user-menu-container') && !event.target.closest('#user-menu-dropdown')) {
                document.getElementById('user-menu-dropdown').classList.add('hidden');
            }
        });
    </script>
</body>
</html>

